@model List<SIAC.Web.Models.Questao>
@{
    ViewBag.Title = "Gerar";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Scripts {
    <script>
        $('.ui.accordion')
            .accordion()
        ;
        $('div,p')
            .popup()
        ;
</script>
}

<h2>Gerar</h2>

<div class="">
    @foreach (var questao in Model)
    {
        <div class="ui segment">
            <div class="ui labels">
                <div class="ui label">
                    Professor
                    <div class="detail">
                        @questao.Professor.Usuario.PessoaFisica.Nome.Split(' ')[0]
                    </div>
                </div>
                <div class="ui label">
                    Disciplina
                    <div class="detail">
                        @questao.QuestaoTema.ElementAt(0).Tema.Disciplina.Descricao
                    </div>
                </div>
                <div class="ui label" data-html="@( !String.IsNullOrEmpty(questao.Dificuldade.Comentario) ? "<b>Comentário</b>: "+questao.Dificuldade.Comentario : "" )">
                    Dificuldade
                    <div class="detail">
                        @questao.Dificuldade.Descricao
                    </div>
                </div>
                @foreach (var questaoTema in questao.QuestaoTema)
                {
                    <div class="ui tag label" data-html="@( !String.IsNullOrEmpty(questaoTema.Tema.Comentario) ? "<b>Comentário</b>: "+questaoTema.Tema.Comentario : "" )">@questaoTema.Tema.Descricao</div>
                }
            </div>
            <div class="ui dividing header" data-html="@( !String.IsNullOrEmpty(questao.Objetivo) ? "<b>Objetivo</b>: " + questao.Objetivo : "")">
                @{
                    var enunciado = questao.Enunciado.Split('\n', '\r');
                    foreach (var strEnunciado in enunciado)
                    {
                        if (!String.IsNullOrWhiteSpace(strEnunciado))
                        {
                            <p>@strEnunciado</p>
                        }
                    }
                }
            </div>
            @if (questao.TipoQuestao.CodTipoQuestao == 1)
            {
                <div class="ui very relaxed list">
                    @foreach (var alternativa in questao.Alternativa)
                    {
                        <div class="item">
                            <div class="middle aligned content" data-html="@(!String.IsNullOrEmpty(alternativa.Comentario) ? "<b>Comentário</b>: " + alternativa.Comentario : "")">
                                <b>@alternativa.CodOrdem.GetIndiceAlternativa()</b>) @alternativa.Enunciado
                                @if (alternativa.FlagGabarito.HasValue && alternativa.FlagGabarito.Value)
                        {
                                    <a class="ui green label">Correta</a>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div data-html="@(!String.IsNullOrEmpty(questao.Comentario) ? "<b>Comentário</b>: " + questao.Comentario : "")">
                    <a class="ui green ribbon label">Chave de Resposta</a>
                    @{
                        var chaveDeResposta = questao.ChaveDeResposta.Split('\n', '\r');
                        foreach (var strChaveDeResposta in chaveDeResposta)
                        {
                            if (!String.IsNullOrWhiteSpace(strChaveDeResposta))
                            {
                                <p><i>@strChaveDeResposta</i></p>
                            }
                        }
                    }
                </div>
                        }
            @if (questao.QuestaoAnexo.Count > 0)
            {
                <br />
                <div class="ui styled fluid accordion">
                    <div class="title"><i class="icon dropdown"></i>Anexos</div>
                    <div class="content">
                        <div class="ui cards">
                            @foreach (var anexo in questao.QuestaoAnexo)
                    {
                        switch (anexo.CodTipoAnexo)
                        {
                            case 1:
                                        <div class="ui card">
                                            <div class="image">
                                                <img src="data:image/png;base64,@Convert.ToBase64String(anexo.Anexo,0, anexo.Anexo.Length)" />
                                            </div>
                                            <div class="content">
                                                <div class="description">
                                                    @anexo.Legenda
                                                </div>
                                            </div>
                                            <div class="extra content">
                                                @(!String.IsNullOrEmpty(anexo.Fonte) ? anexo.Fonte : "Fonte não informada")
                                            </div>
                                        </div>
                                        break;
                                    default:
                                        break;
                                }
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
                        }
</div>
