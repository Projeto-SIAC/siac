siac.Certificacao=siac.Certificacao||{};siac.Certificacao.Gerar=function(){function n(){$(".ui.dropdown").dropdown();$(".ui.modal").modal();$(".ui.termo.modal").modal({closable:!1}).modal("show");$(".cancelar.button").popup({on:"click"});$(".ui.confirmar.modal").modal({onApprove:function(){$("form").addClass("loading").submit()}});$(".prosseguir.button").click(function(){t()});$("#ddlDisciplina").change(function(){r(this.value)});$("#ddlTipo").change(function(){u(this.value)})}function t(){var t=$("form .error.message .list"),n;t.html("");$("form").removeClass("error");n=!0;$("#ddlDisciplina").val()||(t.append("<li>Selecione uma disciplina<\/li>"),n=!1);$("#ddlTemas").val()||(t.append("<li>Selecione ao menos um tema<\/li>"),n=!1);$("#ddlTipo").val()||(t.append("<li>Selecione o tipo das quest\u00f5es da sua avalia\u00e7\u00e3o acad\u00eamica<\/li>"),n=!1);$("#ddlTipo").val()!=1&&$("#ddlTipo").val()!=3||$("#txtQteObjetiva").val()||(t.append("<li>Indique a quantidade das quest\u00f5es objetivas<\/li>"),n=!1);$("#ddlTipo").val()!=2&&$("#ddlTipo").val()!=3||$("#txtQteDiscursiva").val()||(t.append("<li>Indique a quantidade das quest\u00f5es discursivas<\/li>"),n=!1);$("#ddlDificuldade").val()||(t.append("<li>Selecione a dificuldade das quest\u00f5es<\/li>"),n=!1);n?i():($("form").addClass("error"),$("html, body").animate({scrollTop:$("form .error.message").offset().top},1e3))}function i(){$modal=$(".ui.confirmar.modal");$ddlDisciplina=$("#ddlDisciplina :selected");$ddlTipo=$("#ddlTipo");$table=$modal.find("tbody").html("");$tr=$("<tr><\/tr>");$tdDisciplina=$("<td><\/td>").html("<b>"+$ddlDisciplina.text()+"<\/b>");$tdTemas=$('<td class="ui labels"><\/td>');$ddlTemas=$("#ddlTemas :selected");for(var n=0;n<$ddlTemas.length;n++)$tdTemas.append($('<div class="ui tag label"><\/div>').text($ddlTemas.eq(n).text()));$tdQteQuestoes=$('<td class="ui labels"><\/td>');($ddlTipo.val()==1||$ddlTipo.val()==3)&&$tdQteQuestoes.append($('<div class="ui label"><\/div>').html('Objetiva<div class="detail">'+$("#txtQteObjetiva").val()+"<\/div>"));($ddlTipo.val()==2||$ddlTipo.val()==3)&&$tdQteQuestoes.append($('<div class="ui label"><\/div>').html('Discursiva<div class="detail">'+$("#txtQteDiscursiva").val()+"<\/div>"));$tdDificuldade=$("<td><\/td>").text($("#ddlDificuldade :selected").text());$table.append($tr.append($tdDisciplina).append($tdTemas).append($tdQteQuestoes).append($tdDificuldade));$modal.modal("show")}function r(n){var i=$("#ddlDisciplinas"),t=$("#ddlTemas");t.parent().addClass("loading");$.ajax({type:"POST",url:"/Tema/RecuperarTemasPorCodDisciplinaTemQuestao",data:{codDisciplina:n},success:function(n){t.html("");t.val(t.prop("defaultSelected"));$.each(n,function(n,i){t.append('<option value="'+i.CodTema+'">'+i.Descricao+"<\/option>")});t.parent().removeClass("loading")},error:function(){siac.mensagem("Erro no carregamento de Temas","Erro");t.parent().removeClass("loading")}})}function u(n){var t=$("#txtQteObjetiva"),i=$("#txtQteDiscursiva");n==1?(t.prop("disabled",!1),i.prop("disabled",!0)):n==2?(t.prop("disabled",!0),i.prop("disabled",!1)):(t.prop("disabled",!1),i.prop("disabled",!1))}return{iniciar:n}}();siac.Certificacao.Configurar=function(){function v(){$elemento=$("[data-avaliacao]");!r&&$elemento&&(r=$elemento.data("avaliacao"),$elemento.removeAttr("data-avaliacao"));s=$(".informacoes .objetiva.label .detail").html();h=$(".informacoes .discursiva.label .detail").html();$(".questoes.modal .card").map(function(){n.push($(this).attr("id"));$(this).find(".tipo.label").text()==u?t++:$(this).find(".tipo.label").text()==f&&i++});$(".informacoes.button").click(function(){$(".informacoes.modal").modal("show")});$(".ui.dropdown").dropdown().change(function(){y()});$(".ui.questoes.button").click(function(){$(".questoes.modal").modal("show")});$(".ui.detalhe.button").click(function(){var t=$(this).parents(".card").attr("id");l(t,this);console.log(n)});$(".ui.acao.button").click(function(){$_this=$(this);var n=$_this.parents(".card").find(".label").last().text(),t=$_this.parents(".card").attr("id");$_this.html()=="Adicionar"?c(t,n):$_this.html()=="Remover"&&o(t,n)})}function y(){var t=$("#ddlTemas").val(),i=$("#ddlDificuldade").val(),u=$("#ddlTipo").val();t&&i&&u&&($resultado=$(".resultado .cards"),$resultado.addClass("form loading"),$.ajax({type:"POST",url:"/dashboard/avaliacao/certificacao/CarregarQuestoes/",data:{codigo:r,temas:t,dificuldade:i,tipo:u},success:function(t){t&&($cards=$(t),$resultado.html($cards),$resultado.find(".card").map(function(){$card=$(this);var t=$card.attr("id");n.indexOf(t)>-1&&$card.find(".acao.button").text(e)}))},error:function(n){siac.mensagem(n,"Error")},complete:function(){$resultado.removeClass("form loading");$resultado.find(".acao.button").off("click").click(function(){var t,n;$_this=$(this);t=$_this.parents(".card").find(".tipo.label").text();$_this.html()==a?(n=$_this.parents(".card").attr("id"),c(n,t)):$_this.html()==e&&(n=$_this.parents(".card").attr("id"),o(n,t))});$(".ui.detalhe.button").click(function(){var n=$(this).parents(".card").attr("id");l(n,this)})}}))}function c(r,c){var l=!1;c==u?t<s?(l=!0,t++):siac.aviso("Voc\u00ea n\u00e3o pode adicionar mais quest\u00f5es objetivas","red"):c==f&&(i<h?(l=!0,i++):siac.aviso("Voc\u00ea n\u00e3o pode adicionar mais quest\u00f5es discursivas","red"));l&&($card=$("#"+r+".card"),$card.find(".acao.button").text(e).off("click").click(function(){o(r,c)}),n.push(r),$card.transition({onHide:function(){$(".questoes.modal .cards").append($card);siac.aviso("Quest\u00e3o adicionada","green")}}).transition("scale"))}function o(r,e){$card=$("#"+r+".card");var o=n.indexOf(r);o>-1&&(n.splice(o,1),e==u?t--:e==f&&i--);$card.transition({onHide:function(){$card.remove();siac.aviso("Quest\u00e3o removida","red")}}).transition("scale")}function l(t,i){$_this=$(i);$_this.addClass("loading");$.ajax({type:"POST",url:"/dashboard/avaliacao/certificacao/CarregarQuestao/",data:{codQuestao:t},success:function(i){n.indexOf(t)>-1&&(t=n.indexOf(t)+1);$(".questao.modal .header").html("Quest\u00e3o "+t);$(".questao.modal .segment").html(i);$(".accordion").accordion();$(".questao.modal").modal("show")},error:function(n){siac.mensagem(n,"Error")},complete:function(){$_this.removeClass("loading")}})}var r,n=[],t=0,i=0,s,h,u="Objetiva",f="Discursiva",a="Adicionar",e="Remover";return{iniciar:v}}();