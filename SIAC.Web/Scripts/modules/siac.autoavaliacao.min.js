siac.Autoavaliacao=siac.Autoavaliacao||{};siac.Autoavaliacao.Index=function(){function l(){$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-100&&$(".cards .card").length==c*n&&(n++,t())});$(".ui.dropdown").dropdown();$(".pesquisa input").keyup(function(){var i=this;u&&clearTimeout(u);u=setTimeout(function(){h=i.value;n=1;t()},500)});$(".button.topo").click(function(){a()});$(".categoria.item").click(function(){var u=$(this),e,f,r,o;if(n=1,e=u.attr("data-categoria"),u.hasClass("active")){for(f=i,i=[],r=0,o=f.length;r<o;r++)f[r]!=e&&i.push(f[r]);u.removeClass("active")}else i.push(e),u.addClass("active");t()});$(".dificuldade.item").click(function(){var i=$(this);n=1;o=i.attr("data-dificuldade");t()});$(".disciplina.item").click(function(){var i=$(this);n=1;s=i.attr("data-disciplina");t()});$(".ordenar.item").click(function(){var i=$(this);n=1;e=i.attr("data-ordenar");t();$(".ordenar.item").removeClass("active");i.addClass("active")});t()}function t(){r&&r.readyState!=4&&r.abort();$cards=$(".ui.cards");$cards.parent().addClass("loading");r=$.ajax({url:"/Historico/Autoavaliacao/Listar",data:{pagina:n,ordenar:e,dificuldade:o,disciplina:s,categorias:i,pesquisa:h},method:"POST",success:function(t){t!=f&&(n==1?$cards.html(t):$cards.append(t),f=t)},complete:function(){$cards.parent().removeClass("loading");v()}})}function a(){return $("html, body").animate({scrollTop:0},500),!1}function v(){$(".arquivar.button").click(function(){var n=$(this),t=n.parents("[data-avaliacao]").attr("data-avaliacao");n.addClass("loading");$.ajax({type:"POST",data:{codigo:t},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.location.href="/historico/autoavaliacao/detalhe/"+t},error:function(){siac.mensagem("N\u00e3o foi poss\u00edvel arquivar a autoavalia\u00e7\u00e3o.");n.removeClass("loading")}})})}var u,f,c=10,r,n=1,e="data_desc",i=[],o="",s="",h="";return{iniciar:l}}();siac.Autoavaliacao.Detalhe=function(){function t(){$elemento=$("[data-avaliacao]");n=$elemento.attr("data-avaliacao");$elemento.removeAttr("data-avaliacao");$(".ui.accordion").accordion({animateChildren:!1});$(".label, div").popup();$(".arquivar.button").click(function(){var t=$(this);t.addClass("loading");$.ajax({type:"POST",data:{codigo:n},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.location.href="/historico/autoavaliacao/detalhe/"+n},error:function(){siac.mensagem("N\u00e3o foi poss\u00edvel arquivar a autoavalia\u00e7\u00e3o.")},complete:function(){$(_this).removeClass("loading")}})})}var n;return{iniciar:t}}();siac.Autoavaliacao.Resultado=function(){function n(){$(".ui.accordion").accordion({animateChildren:!1});$(".label, div").popup()}return{iniciar:n}}();siac.Autoavaliacao.Realizar=function(){function u(){$elemento=$("[data-avaliacao]");n=$elemento.attr("data-avaliacao");$elemento.removeAttr("data-avaliacao"),function(){setInterval(function(){$.ajax({type:"GET",url:"/Acesso/Conectado"})},9e5)}();r();$("a[href]").on("click",function(){return $(".ui.confirmar.modal").modal("show"),$(".ui.confirmar.modal #txtRef").val($(this).attr("href")),!1});$(".ui.checkbox").checkbox();$(".ui.verificar.modal").modal({closable:!1,transition:"vertical flip",blurring:!0,onHide:function(){window.onbeforeunload=function(){return"Voc\u00ea est\u00e1 realizando uma autoavalia\u00e7\u00e3o."}}}).modal("show");$(".ui.cronometrar.modal").modal({closable:!1,onApprove:function(){date=new Date;$("#lblHoraInicio").text(date.getHours()+"h"+("0"+date.getMinutes()).slice(-2)+"min");$("#lblHoraAgora").text(date.getHours()+"h"+("0"+date.getMinutes()).slice(-2)+"min");setTimeout(f(),(60-date.getSeconds())*1e3);$("#chkCronometrar").is(":checked")?(duracao=$("#txtDuracao").val(),$("#lblHoraDuracao").text(duracao.minutosParaStringTempo()),$("#lblHoraRestante").text(duracao.minutosParaStringTempo()),e(new Date(date.getTime()+duracao*6e4))):($("#lblHoraRestante").parent().remove(),$("#lblHoraDuracao").parent().remove())}}).modal("attach events",".ui.verificar.modal .iniciar.button");$(".ui.informacoes.modal").modal();$(".ui.anexo.modal").modal();$(".ui.confirmar.modal").modal({onApprove:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};window.location.href=$(".ui.confirmar.modal #txtRef").val()},onDeny:function(){$(".ui.segment.loading").removeClass("loading")}});$(".ui.accordion").accordion({animateChildren:!1});$(".arquivar.button").click(function(){c()});$(".finalizar.button").click(function(){s()});$(".card.anexo.imagem").click(function(){o(this)});$('textarea[name^="txtResposta"], input[name^="rdoResposta"]').change(function(){var n=$(this);$label=n.parents(".content").prev().find(".ui.label");n.val()?($label.removeClass("red"),$label.removeAttr("style"),$label.html("Respondida"),n.attr("name").indexOf("rdo")>-1&&($label.find(".detail").remove(),$label.append($('<div class="detail"><\/div>').text($('input[name="'+n.attr("name")+'"]:checked').next().find("b").text())))):$label.attr("style","display:none")});$(".ui.gabarito.modal").modal({onApprove:function(){return $.ajax({type:"GET",url:"/Acesso/Conectado",success:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};$("form").submit()},error:function(){siac.mensagem("Conecte-se \u00e0 internet antes de confirmar.")}}),!1}})}function r(){var n=$(window).height(),t=n*.6;$(".ui.accordion").css({"max-height":t+"px","overflow-y":"auto"})}function f(){setInterval(function(){var n=new Date;$("#lblHoraAgora").text(n.getHours()+"h"+("0"+n.getMinutes()).slice(-2)+"min")},1e3)}function e(n){t=setInterval(function(){var e=n.getTimezoneOffset()*6e4,f=n.getTime()+e-((new Date).getTime()+e),r,o,u;f>0?(r=new Date,r.setTime(f),o=r.getTimezoneOffset()*6e4,r.setTime(r.getTime()+o),u=r.getHours()+"h"+("0"+r.getMinutes()).slice(-2)+"min",$("#lblHoraRestante").text(u),u!=i&&$("#lblHoraRestante").parent().transition("flash"),i=u,f<3e5&&!$("#lblHoraRestante").parent().hasClass("red")&&$("#lblHoraRestante").parent().addClass("red")):(siac.mensagem("O tempo definido por voc\u00ea acabou.","O tempo acabou."),clearInterval(t))},1e3)}function o(n){n=$(n);src=n.find("img").attr("src");legenda=n.find(".header").text();fonte=n.find(".description").text();modal=$(".ui.anexo.modal");modal.find(".header").text(legenda);modal.find("img.image").attr("src",src);modal.find(".description").html(fonte);modal.modal("show")}function s(){var i=!0,t,u,n;for($objects=$('textarea[name^="txtResposta"], input[name^="rdoResposta"]'),t=0,u=$objects.length;t<u;t++)n=$objects.eq(t),$label=n.parents(".content").prev().find(".ui.label"),n.attr("name").indexOf("rdo")>-1?$('input[name="'+n.attr("name")+'"]:checked').length===0&&($label.removeAttr("style").addClass("red").html("N\u00e3o respondida").transition("tada"),i=!1):n.val()||($label.removeAttr("style").addClass("red").html("N\u00e3o respondida").transition("tada"),i=!1);i?h():(r(),$("html, body").animate({scrollTop:$(".title .label.red").offset().top},1e3))}function h(){$modal=$(".ui.gabarito.modal");$accordion=$("form .ui.accordion").clone();$accordion.removeAttr("style");$modal.find(".content").html($('<div class="ui form"><\/div>').append($accordion));$modalAccordion=$modal.find(".ui.accordion");$modalAccordion.accordion({onChange:function(){$(".ui.gabarito.modal").modal("refresh")},animateChildren:!1});$lstInput=$modalAccordion.find(":input,a");for(var n=0;n<$lstInput.length;n++)$lstInput.eq(n).attr({readonly:"readonly"}).removeAttr("href").removeAttr("onchange").removeAttr("onclick").off();$modal.modal("show")}function c(){$.ajax({type:"POST",data:{codigo:n},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};window.location.href="/historico/autoavaliacao/detalhe/"+n},error:function(){siac.mensagem("N\u00e3o foi poss\u00edvel arquivar a autoavalia\u00e7\u00e3o.")}})}var n,t,i;return{iniciar:u}}();siac.Autoavaliacao.Gerar=function(){function i(){$json=$("code.json");n=JSON.parse($json.html());$json.remove();$(".ui.dropdown").dropdown();$(".ui.accordion").accordion({animateChildren:!1});$(".prosseguir.button").click(function(){r()});$(".ui.confirmar.modal").modal({onApprove:function(){$("form").submit()}});$("#ddlTipo").change(function(){t()});$("#ddlDisciplinas").parent().mouseout(function(){$(".ui.dropdown").dropdown()});$("#ddlDisciplinas").change(function(){f()});$(".cancelar.button").popup({on:"click"})}function r(){var i=!1,t,r,n;if($list=$("form .error.message .list"),$list.html(""),$("#ddlDisciplinas :selected").length>0)for(t=$("#ddlDisciplinas").val(),r=!0,n=0;n<t.length;n++)!$("#ddlTemas"+t[n]+" :selected").length>0&&($list.append("<li>Selecione pelo menos um tema para "+$('#ddlDisciplinas option[value="'+t[n]+'"]').text()+"<\/li>"),i=!1),$("#ddlDificuldade"+t[n]).val()||($list.append("<li>Selecione a dificuldade para "+$('#ddlDisciplinas option[value="'+t[n]+'"]').text()+"<\/li>"),i=!1),$("#ddlTipo").val()?(r=!0,$("#ddlTipo").val()=="1"?$("#txtQteObjetiva"+t[n]).val()||(r=!1,i=!1,$list.append("<li>Preencha a quantidade das quest\u00f5es para "+$('#ddlDisciplinas option[value="'+t[n]+'"]').text()+"<\/li>")):$("#ddlTipo").val()=="2"?$("#txtQteDiscursiva"+t[n]).val()||(r=!1,i=!1,$list.append("<li>Preencha a quantidade das quest\u00f5es para "+$('#ddlDisciplinas option[value="'+t[n]+'"]').text()+"<\/li>")):$("#ddlTipo").val()=="3"&&($("#txtQteDiscursiva"+t[n]).val()&&$("#txtQteObjetiva"+t[n]).val()||(r=!1,i=!1,$list.append("<li>Preencha a quantidade das quest\u00f5es para "+$('#ddlDisciplinas option[value="'+t[n]+'"]').text()+"<\/li>")))):($list.html("<li>Selecione o tipo das quest\u00f5es<\/li>"),r=!1,i=!1),i=r==!0?!0:!1;else $list.append("<li>Selecione pelo menos uma disciplina<\/li>"),i=!1;i?e():($("form").addClass("error"),$("html, body").animate({scrollTop:$("form .error.message").offset().top},1e3))}function u(n){var t=$("#ddlTemas"+n);$.ajax({cache:!1,type:"POST",url:"/Tema/RecuperarTemasPorCodDisciplinaTemQuestao",data:{codDisciplina:n},success:function(n){t.html("");t.parent().find(".label").remove();for(var i=0,r=n.length;i<r;i++)t.append($("<option><\/option>").val(n[i].CodTema).html(n[i].Descricao))},error:function(){siac.mensagem("Falha ao recuperar temas.")}})}function f(){var r=$("#ddlDisciplinas").val(),f,s,i,e;$(".ui.accordion").html("");var h=$(".ui.tema.accordion"),c=$(".ui.dificuldade.accordion"),l=$(".ui.quantidade.accordion"),o;for(f=0,s=n.length;f<s;f++)o+='<option value="'+n[f].Codigo+'">'+n[f].Descricao+"<\/option>";for(i=0;i<r.length;i++)e=$('#ddlDisciplinas option[value="'+r[i]+'"]').text(),h.append('<div class="title"><i class="icon dropdown"><\/i>'+e+'<\/div><div class="content"><div class="field"><select required name="ddlTemas'+r[i]+'" id="ddlTemas'+r[i]+'" class="ui search dropdown" multiple><option value="">Tema<\/option><\/select><\/div><\/div>'),u(r[i]),c.append('<div class="title"><i class="icon dropdown"><\/i>'+e+'<\/div><div class="content"><div class="field"><select required id="ddlDificuldade'+r[i]+'" name="ddlDificuldade'+r[i]+'" class="ui search dropdown"><option value="">Dificuldade<\/option>'+o+"<\/select><\/div><\/div>"),l.append('<div class="title"><i class="icon dropdown"><\/i>'+e+'<\/div><div class="content"><div class="two fields"><div class="field objetiva"><label>Objetivas<\/label><input required id="txtQteObjetiva'+r[i]+'" name="txtQteObjetiva'+r[i]+'" data-mask="0#" type="number" placeholder="Quantidade de objetivas" min="1" /><\/div><div class="field discursiva"><label>Discursivas<\/label><input required id="txtQteDiscursiva'+r[i]+'" name="txtQteDiscursiva'+r[i]+'" data-mask="0#" type="number" placeholder="Quantidade de discursivas" min="1" /><\/div><\/div><\/div>');t()}function t(){var n=$("#ddlTipo").val();switch(n){case"1":$(".discursiva").addClass("disabled").attr("style","pointer-events: none");$(".objetiva").removeClass("disabled").removeAttr("style");break;case"2":$(".discursiva").removeClass("disabled").removeAttr("style");$(".objetiva").addClass("disabled").attr("style","pointer-events: none");break;case"3":$(".discursiva").removeClass("disabled").removeAttr("style");$(".objetiva").removeClass("disabled").removeAttr("style");break;default:$(".discursiva").addClass("disabled").attr("style","pointer-events: none");$(".objetiva").addClass("disabled").attr("style","pointer-events: none")}}function e(){var n,t;for($modal=$(".ui.confirmar.modal"),$ddlDisciplinas=$("#ddlDisciplinas :selected"),$ddlTipo=$("#ddlTipo"),$table=$modal.find("tbody").html(""),n=0;n<$ddlDisciplinas.length;n++){for($tr=$("<tr><\/tr>"),$tdDisciplina=$("<td><\/td>").html("<b>"+$ddlDisciplinas.eq(n).text()+"<\/b>"),$tdTemas=$('<td class="ui labels"><\/td>'),$ddlTemas=$("#ddlTemas"+$ddlDisciplinas.eq(n).val()+" :selected"),t=0;t<$ddlTemas.length;t++)$tdTemas.append($('<div class="ui tag label"><\/div>').text($ddlTemas.eq(t).text()));$tdQteQuestoes=$('<td class="ui labels"><\/td>');($ddlTipo.val()==1||$ddlTipo.val()==3)&&$tdQteQuestoes.append($('<div class="ui label"><\/div>').html('Objetiva<div class="detail">'+$("#txtQteObjetiva"+$ddlDisciplinas.eq(n).val()).val()+"<\/div>"));($ddlTipo.val()==2||$ddlTipo.val()==3)&&$tdQteQuestoes.append($('<div class="ui label"><\/div>').html('Discursiva<div class="detail">'+$("#txtQteDiscursiva"+$ddlDisciplinas.eq(n).val()).val()+"<\/div>"));$tdDificuldade=$("<td><\/td>").text($("#ddlDificuldade"+$ddlDisciplinas.eq(n).val()+" :selected").text());$table.append($tr.append($tdDisciplina).append($tdTemas).append($tdQteQuestoes).append($tdDificuldade))}$modal.modal("show")}var n;return{iniciar:i}}();