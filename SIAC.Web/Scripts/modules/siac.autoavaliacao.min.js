siac.Autoavaliacao=siac.Autoavaliacao||{};siac.Autoavaliacao.Index=function(){function s(){$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-100&&(n++,t())});$(".ui.dropdown").dropdown();$(".pesquisa input").keyup(function(){var n=this;r&&clearTimeout(r);r=setTimeout(function(){o=n.value;t()},500)});$(".button.topo").click(function(){h()});$(".categoria.item").click(function(){var u=$(this),e,f,r,o;if(n=1,e=u.attr("data-categoria"),u.hasClass("active")){for(f=i,i=[],r=0,o=f.length;r<o;r++)f[r]!=e&&i.push(f[r]);u.removeClass("active")}else i.push(e),u.addClass("active");t()});$(".dificuldade.item").click(function(){var i=$(this);n=1;f=i.attr("data-dificuldade");t()});$(".disciplina.item").click(function(){var i=$(this);n=1;e=i.attr("data-disciplina");t()});$(".ordenar.item").click(function(){var i=$(this);n=1;u=i.attr("data-ordenar");t();$(".ordenar.item").removeClass("active");i.addClass("active")});t()}function t(){$cards=$(".ui.cards");$cards.parent().addClass("loading");$.ajax({url:"/Historico/Autoavaliacao/Listar",data:{pagina:n,ordenar:u,dificuldade:f,disciplina:e,categorias:i,pesquisa:o},method:"POST",success:function(t){n==1?$cards.html(t):$cards.append(t)},complete:function(){$cards.parent().removeClass("loading")}})}function h(){return $("html, body").animate({scrollTop:0},500),!1}var r,n=1,u="data_desc",i=[],f="",e="",o="";return{iniciar:s}}();siac.Autoavaliacao.Detalhe=function(){function t(){n=$("[data-avaliacao]").attr("data-avaliacao");$(".ui.accordion").accordion({animateChildren:!1});$(".label, div").popup();$(".arquivar.button").click(function(){var t=$(this);t.addClass("loading");$.ajax({type:"POST",data:{codigo:n},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.location.href="/Historico/Autoavaliacao/Detalhe/"+n},error:function(){siac.mensagem("Não foi possível arquivar a autoavaliação.")},complete:function(){$(_this).removeClass("loading")}})})}var n;return{iniciar:t}}();siac.Autoavaliacao.Resultado=function(){function n(){$(".ui.accordion").accordion({animateChildren:!1});$(".label, div").popup()}return{iniciar:n}}();siac.Autoavaliacao.Realizar=function(){function u(){n=$("[data-avaliacao]").attr("data-avaliacao"),function(){setInterval(function(){$.ajax({type:"GET",url:"/Acesso/Conectado"})},9e5)}();r();$("a[href]").on("click",function(){return $(".ui.confirmar.modal").modal("show"),$(".ui.confirmar.modal #txtRef").val($(this).attr("href")),!1});$(".ui.checkbox").checkbox();$(".ui.verificar.modal").modal({closable:!1,transition:"vertical flip",blurring:!0,onHide:function(){window.onbeforeunload=function(){return"Você está realizando uma autoavaliação."}}}).modal("show");$(".ui.cronometrar.modal").modal({closable:!1,onApprove:function(){date=new Date;$("#lblHoraInicio").text(date.getHours()+"h"+("0"+date.getMinutes()).slice(-2)+"min");$("#lblHoraAgora").text(date.getHours()+"h"+("0"+date.getMinutes()).slice(-2)+"min");setTimeout(f(),(60-date.getSeconds())*1e3);$("#chkCronometrar").is(":checked")?(duracao=$("#txtDuracao").val(),$("#lblHoraDuracao").text(siac.Utilitario.minutosParaStringTempo(duracao)),$("#lblHoraRestante").text(siac.Utilitario.minutosParaStringTempo(duracao)),e(new Date(date.getTime()+duracao*6e4))):($("#lblHoraRestante").parent().remove(),$("#lblHoraDuracao").parent().remove())}}).modal("attach events",".ui.verificar.modal .iniciar.button");$(".ui.informacoes.modal").modal();$(".ui.anexo.modal").modal();$(".ui.confirmar.modal").modal({onApprove:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};window.location.href=$(".ui.confirmar.modal #txtRef").val()},onDeny:function(){$(".ui.segment.loading").removeClass("loading")}});$(".ui.accordion").accordion({exclusive:!1,animateChildren:!1});$(".arquivar.button").click(function(){c()});$(".finalizar.button").click(function(){s()});$(".card.anexo.imagem").click(function(){o(this)});$('textarea[name^="txtResposta"], input[name^="rdoResposta"]').change(function(){var n=$(this);$label=n.parents(".content").prev().find(".ui.label");n.val()?($label.removeClass("red"),$label.removeAttr("style"),$label.html("Respondida"),n.attr("name").indexOf("rdo")>-1&&($label.find(".detail").remove(),$label.append($('<div class="detail"><\/div>').text($('input[name="'+n.attr("name")+'"]:checked').next().find("b").text())))):$label.attr("style","display:none")});$(".ui.gabarito.modal").modal({onApprove:function(){return $.ajax({type:"GET",url:"/Acesso/Conectado",success:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};$("form").submit()},error:function(){siac.mensagem("Conecte-se à internet antes de confirmar.")}}),!1}})}function r(){var n=$(window).height(),t=n*.6;$(".ui.accordion").css({"max-height":t+"px","overflow-y":"auto"})}function f(){setInterval(function(){var n=new Date;$("#lblHoraAgora").text(n.getHours()+"h"+("0"+n.getMinutes()).slice(-2)+"min")},1e3)}function e(n){t=setInterval(function(){var e=n.getTimezoneOffset()*6e4,f=n.getTime()+e-((new Date).getTime()+e),r,o,u;f>0?(r=new Date,r.setTime(f),o=r.getTimezoneOffset()*6e4,r.setTime(r.getTime()+o),u=r.getHours()+"h"+("0"+r.getMinutes()).slice(-2)+"min",$("#lblHoraRestante").text(u),u!=i&&$("#lblHoraRestante").parent().transition("flash"),i=u,f<3e5&&!$("#lblHoraRestante").parent().hasClass("red")&&$("#lblHoraRestante").parent().addClass("red")):(siac.mensagem("O tempo definido por você acabou.","O tempo acabou."),clearInterval(t))},1e3)}function o(n){n=$(n);src=n.find("img").attr("src");legenda=n.find(".header").text();fonte=n.find(".description").text();modal=$(".ui.anexo.modal");modal.find(".header").text(legenda);modal.find("img.image").attr("src",src);modal.find(".description").html(fonte);modal.modal("show")}function s(){var i=!0,t,u,n;for($objects=$('textarea[name^="txtResposta"], input[name^="rdoResposta"]'),t=0,u=$objects.length;t<u;t++)n=$objects.eq(t),$label=n.parents(".content").prev().find(".ui.label"),n.attr("name").indexOf("rdo")>-1?$('input[name="'+n.attr("name")+'"]:checked').length===0&&($label.removeAttr("style").addClass("red").html("Não respondida").transition("tada"),i=!1):n.val()||($label.removeAttr("style").addClass("red").html("Não respondida").transition("tada"),i=!1);i?h():(r(),$("html, body").animate({scrollTop:$(".title .label.red").offset().top},1e3))}function h(){$modal=$(".ui.gabarito.modal");$accordion=$("form .ui.accordion").clone();$accordion.removeAttr("style");$modal.find(".content").html($('<div class="ui form"><\/div>').append($accordion));$modalAccordion=$modal.find(".ui.accordion");$modalAccordion.accordion({onChange:function(){$(".ui.gabarito.modal").modal("refresh")},animateChildren:!1});$lstInput=$modalAccordion.find(":input,a");for(var n=0;n<$lstInput.length;n++)$lstInput.eq(n).attr({readonly:"readonly"}).removeAttr("href").removeAttr("onchange").removeAttr("onclick").off();$modal.modal("show")}function c(){$.ajax({type:"POST",data:{codigo:n},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};window.location.href="/Historico/Autoavaliacao/Detalhe/"+n},error:function(){siac.mensagem("Não foi possível arquivar a autoavaliação.")}})}var n,t,i;return{iniciar:u}}();