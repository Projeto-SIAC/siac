siac.Autoavaliacao=siac.Autoavaliacao||{};siac.Autoavaliacao.Index=function(){function s(){$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-100&&(n++,t())});$(".ui.dropdown").dropdown();$(".pesquisa input").keyup(function(){var n=this;r&&clearTimeout(r);r=setTimeout(function(){o=n.value;t()},500)});$(".button.topo").click(function(){h()});$(".categoria.item").click(function(){var u=$(this),e,f,r,o;if(n=1,e=u.attr("data-categoria"),u.hasClass("active")){for(f=i,i=[],r=0,o=f.length;r<o;r++)f[r]!=e&&i.push(f[r]);u.removeClass("active")}else i.push(e),u.addClass("active");t()});$(".dificuldade.item").click(function(){var i=$(this);n=1;f=i.attr("data-dificuldade");t()});$(".disciplina.item").click(function(){var i=$(this);n=1;e=i.attr("data-disciplina");t()});$(".ordenar.item").click(function(){var i=$(this);n=1;u=i.attr("data-ordenar");t();$(".ordenar.item").removeClass("active");i.addClass("active")});t()}function t(){$cards=$(".ui.cards");$cards.parent().addClass("loading");$.ajax({url:"/Historico/Autoavaliacao/Listar",data:{pagina:n,ordenar:u,dificuldade:f,disciplina:e,categorias:i,pesquisa:o},method:"POST",success:function(t){n==1?$cards.html(t):$cards.append(t)},complete:function(){$cards.parent().removeClass("loading")}})}function h(){return $("html, body").animate({scrollTop:0},500),!1}var r,n=1,u="data_desc",i=[],f="",e="",o="";return{iniciar:s}}();siac.Autoavaliacao.Detalhe=function(){function t(){n=$("[data-avaliacao]").attr("data-avaliacao");$(".ui.accordion").accordion({animateChildren:!1});$(".label, div").popup();$(".arquivar.button").click(function(){var t=$(this);t.addClass("loading");$.ajax({type:"POST",data:{codigo:n},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.location.href="/Historico/Autoavaliacao/Detalhe/"+n},error:function(){siac.mensagem("Não foi possível arquivar a autoavaliação.")},complete:function(){$(_this).removeClass("loading")}})})}var n;return{iniciar:t}}();siac.Autoavaliacao.Resultado=function(){function n(){$(".ui.accordion").accordion({animateChildren:!1});$(".label, div").popup()}return{iniciar:n}}();siac.Autoavaliacao.Realizar=function(){function e(){i=$("[data-avaliacao]").attr("data-avaliacao"),function(){setInterval(function(){$.ajax({type:"GET",url:"/Acesso/Conectado"})},9e5)}();u();$("a[href]").on("click",function(){return $(".ui.confirmar.modal").modal("show"),$(".ui.confirmar.modal #txtRef").val($(this).attr("href")),!1});$(".ui.checkbox").checkbox();$(".ui.verificar.modal").modal({closable:!1,transition:"vertical flip",blurring:!0,onHide:function(){window.onbeforeunload=function(){return"Você está realizando uma autoavaliação."}}}).modal("show");$(".ui.cronometrar.modal").modal({closable:!1,onApprove:function(){n=new Date;$("#lblHoraInicio").text(n.getHours()+"h"+("0"+n.getMinutes()).slice(-2)+"min");$("#lblHoraAgora").text(n.getHours()+"h"+("0"+n.getMinutes()).slice(-2)+"min");setTimeout(o(),(60-n.getSeconds())*1e3);$("#chkCronometrar").is(":checked")?(t=$("#txtDuracao").val(),$("#lblHoraDuracao").text(siac.Utilitario.minutosParaStringTempo(t)),$("#lblHoraRestante").text(siac.Utilitario.minutosParaStringTempo(t)),s()):($("#lblHoraRestante").parent().remove(),$("#lblHoraDuracao").parent().remove())}}).modal("attach events",".ui.verificar.modal .iniciar.button");$(".ui.informacoes.modal").modal();$(".ui.anexo.modal").modal();$(".ui.confirmar.modal").modal({onApprove:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};window.location.href=$(".ui.confirmar.modal #txtRef").val()},onDeny:function(){$(".ui.segment.loading").removeClass("loading")}});$(".ui.accordion").accordion({exclusive:!1,animateChildren:!1});$(".ui.gabarito.modal").modal({onShow:function(){h()},onApprove:function(){if(r)window.onbeforeunload=null,$("form").addClass("loading").submit();else return siac.mensagem("Conecte-se à internet antes de confirmar."),!1}});$(".message .close").on("click",function(){$(this).closest(".message").transition("fade")});$(".arquivar.button").click(function(){y()});$(".finalizar.button").click(function(){a()})}function u(){var n=$(window).height(),t=n*.6;$(".ui.accordion").css("max-height",t+"px").css("overflow-y","scroll")}function o(){setInterval(function(){n=new Date;$("#lblHoraAgora").text(n.getHours()+"h"+("0"+n.getMinutes()).slice(-2)+"min")},1e3)}function s(){f=setInterval(function(){t>0?(t=t-1,$("#lblHoraRestante").text(siac.Utilitario.minutosParaStringTempo(t)).parent().transition("flash"),t<6&&!$("#lblHoraRestante").parent().hasClass("red")&&$("#lblHoraRestante").parent().addClass("red")):clearInterval(f)},6e4)}function h(){$.ajax({type:"GET",url:"/Acesso/Conectado",success:function(){r=!0},error:function(){r=!1}})}function c(n){n=$(n);src=n.find("img").attr("src");legenda=n.find(".header").text();fonte=n.find(".description").text();modal=$(".ui.anexo.modal");modal.find(".header").text(legenda);modal.find("img.image").attr("src",src);modal.find(".description").html(fonte);modal.modal("show")}function l(n,t,i){$label=$(".ui.accordion").find('#txtCodQuestao[value="'+n+'"]').parent().find(".ui.label");t!=""?($label.removeClass("red"),$label.removeAttr("style"),$label.addClass("teal"),$label.html("Respondida"),i&&$label.append($('<div class="detail"><\/div>').text(t))):$label.attr("style","display:none");u()}function a(){var f,t,i,e,n,r;for($("form").removeClass("error"),f=!0,t=[],$lstTitle=$(".ui.accordion > .title"),n=0;n<$lstTitle.length;n++)i=$lstTitle.eq(n).find("#txtCodQuestao").val(),e=$lstTitle.eq(n).next().find("#txtResposta"+i).val(),e==""?(f=!1,t.push(i)):e||$lstTitle.eq(n).next().find('input[name="rdoResposta'+i+'"]').is(":checked")||(f=!1,t.push(i));if(f)v();else{for(n=0;n<t.length;n++)for(r=0;r<$lstTitle.length;r++)$lstTitle.eq(r).find("#txtCodQuestao").val()==t[n]&&$lstTitle.eq(r).find(".ui.label").removeAttr("style").removeClass("teal").addClass("red").html("Não respondida").transition("tada");$("form").addClass("error");$("form .message").removeClass("hidden");u()}}function v(){$modal=$(".ui.gabarito.modal");$accordion=$("form .ui.accordion").clone();$accordion.removeAttr("style");$modal.find(".content").html($('<div class="ui form"><\/div>').append($accordion));$modalAccordion=$modal.find(".ui.accordion");$modalAccordion.accordion({onChange:function(){$(".ui.gabarito.modal").modal("refresh")},animateChildren:!1});$lstInput=$modalAccordion.find(":input,a");for(var n=0;n<$lstInput.length;n++)$lstInput.eq(n).attr({readonly:"readonly"}).removeAttr("href").removeAttr("onchange").removeAttr("onclick").off();$modal.modal("show")}function y(){$.ajax({type:"POST",data:{codigo:i},url:"/Dashboard/Autoavaliacao/Arquivar",success:function(){window.onbeforeunload=function(){$(".ui.global.loader").parent().addClass("active")};window.location.href="/Historico/Autoavaliacao/Detalhe/"+i},error:function(){siac.mensagem("Não foi possível arquivar a autoavaliação.")}})}var i,n,t,f,r=!1;return{iniciar:e,gabarito:l,expandirImagem:c}}();